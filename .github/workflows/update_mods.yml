<script>
async function exportarJSON() {
    if (modsAuto.length === 0) {
        alert("No hay mods para exportar.");
        return;
    }

    const modsStr = JSON.stringify(modsAuto, null, 2);

    const url = "https://api.github.com/repos/RyujiSaiyan/ryujisaiyan.github.io/contents/trigger_mods.json";

    const commitMessage = "Actualización automática de mods";

    const fileContent = btoa(unescape(encodeURIComponent(modsStr)));

    // 1) Obtener SHA si el archivo existe (obligatorio para actualizar)
    let sha = null;
    try {
        const r = await fetch(url);
        if (r.ok) {
            const d = await r.json();
            sha = d.sha;
        }
    } catch (e) {}

    // 2) Hacer commit usando el token interno de GitHub (no expuesto)
    const result = await fetch(url + "?ref=modsync", {
        method: "PUT",
        headers: {
            "Accept": "application/vnd.github+json"
        },
        body: JSON.stringify({
            message: commitMessage,
            content: fileContent,
            branch: "modsync",
            sha: sha || undefined
        })
    });

    alert("✔ Mods enviados, GitHub Actions actualizará mods.json");
}
</script>
