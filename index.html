<!DOCTYPE html>
<html lang="es" data-bs-theme="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Mi Blog Anime Dark</title>

<!-- BOOTSTRAP -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<style>
/* -------------------- */
/* PALETA ANIME LAVANDA */
/* -------------------- */
:root {
    --lavanda: #A39ACB;
    --lavanda-light: #c7bafd;
    --bg-dark: #0A1228;
    --card-bg: #1B1E24;
    --border-dark: #2F333D;
}

body {
    background: var(--bg-dark);
    color: #E8ECF9;
    font-family: "Roboto", sans-serif;
}

.section-title {
    border-left: 5px solid var(--lavanda);
    padding-left: 12px;
    margin-top: 50px;
    margin-bottom: 20px;
    font-size: 1.6rem;
}

/* ========================================================= */
/* ==================== NETFLIX CAROUSEL ==================== */
/* ========================================================= */

.carousel-row {
    position: relative;
    overflow: hidden;
}

.carousel-container {
    display: flex;
    gap: 18px;
    overflow-x: auto;
    scroll-behavior: smooth;
    padding: 12px 0;
}

.carousel-container::-webkit-scrollbar {
    height: 10px;
}

.carousel-container::-webkit-scrollbar-thumb {
    background: var(--lavanda);
    border-radius: 5px;
}

.carousel-container::-webkit-scrollbar-track {
    background: #111727;
}

/* TARJETAS TIPO NETFLIX ‚Äî Hover C1 */
.n-card {
    min-width: 240px;
    max-width: 240px;
    background: var(--card-bg);
    border-radius: 14px;
    border: 1px solid var(--border-dark);
    overflow: hidden;
    transition: transform 0.25s ease, box-shadow 0.25s ease, border-color 0.3s;
    cursor: pointer;
}

.n-card:hover {
    transform: scale(1.15);
    border-color: var(--lavanda);
    box-shadow: 0 0 25px rgba(163,154,203,0.6);
    z-index: 3;
}

.n-card img {
    width: 100%;
    height: 150px;
    object-fit: cover;
}

.n-card .body {
    padding: 12px;
}

/* FLECHAS ESTILO NETFLIX (N2) */
.carousel-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 55px;
    height: 120px;
    background: rgba(10, 18, 40, 0.55);
    backdrop-filter: blur(5px);
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: var(--lavanda);
    font-size: 2rem;
    cursor: pointer;
    z-index: 10;
    transition: 0.2s;
    opacity: 0;
}

.carousel-row:hover .carousel-arrow {
    opacity: 1;
}

.carousel-arrow:hover {
    background: rgba(163,154,203,0.3);
    color: var(--lavanda-light);
}

/* Left & Right */
.carousel-arrow.left {
    left: 0;
}

.carousel-arrow.right {
    right: 0;
}

/* ======================== MODAL ======================== */

.modal-bg-blur {
    position: absolute;
    inset: 0;
    z-index: 1;
    background-size: cover !important;
    background-position: center !important;
    filter: blur(18px);
    opacity: 0.35;
    border-radius: 18px;
    pointer-events: none !important;
}

.modal-content {
    position: relative;
    z-index: 2;
    background: rgba(16, 22, 38, 0.85) !important;
    backdrop-filter: blur(6px);
    border-radius: 18px !important;
    border: 1px solid var(--lavanda) !important;
}

#modal-img {
    width: 100%;
    max-width: 360px;
    border-radius: 16px;
    border: 2px solid rgba(163,154,203,0.5);
    box-shadow: 0px 0px 25px rgba(0,0,0,0.6);
    cursor: zoom-in;
}

/* LIGHTBOX */
#lightbox-bg {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(5px);
    z-index: 99999;
    justify-content: center;
    align-items: center;
}
#lightbox-img {
    max-width: 90%;
    max-height: 90%;
    border-radius: 18px;
    border: 2px solid var(--lavanda);
    box-shadow: 0 0 25px rgba(163,154,203,0.8);
}
#lightbox-bg:hover { cursor: zoom-out; }

</style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
  <a class="navbar-brand fw-bold" href="#">MiBlog</a>

  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navMenu">
    <ul class="navbar-nav ms-auto">
      <li class="nav-item"><a class="nav-link" href="#">Inicio</a></li>
      <li class="nav-item"><a class="nav-link" href="#videos">Videos</a></li>
      <li class="nav-item"><a class="nav-link" href="#mods">Mods</a></li>
    </ul>
  </div>
</nav>

<!-- CONTENIDO -->
<div class="container-fluid py-4">

    <!-- SECCI√ìN: M√ÅS POPULAR -->
    <h2 class="section-title">M√°s popular</h2>
    <div class="main-video mb-4">
        <iframe id="popular-video" src="" allowfullscreen style="width:100%;height:420px;border-radius:12px;"></iframe>
        <h3 id="popular-title" class="mt-3">Cargando...</h3>
        <small id="popular-date" class="text-secondary"></small>
        <p id="popular-desc" class="text-secondary mt-2">Obteniendo el video m√°s visto...</p>
    </div>

    <!-- √öLTIMOS VIDEOS -->
    <h2 class="section-title" id="videos">√öltimos videos</h2>

    <div class="carousel-row">
        <div class="carousel-arrow left" onclick="scrollCarousel('videos-carousel', -1)">‚ùÆ</div>
        <div class="carousel-arrow right" onclick="scrollCarousel('videos-carousel', 1)">‚ùØ</div>

        <div id="videos-carousel" class="carousel-container">
            <p>Cargando videos...</p>
        </div>
    </div>

    <!-- MODS -->
    <h2 class="section-title" id="mods">Mods</h2>

    <div class="carousel-row">
        <div class="carousel-arrow left" onclick="scrollCarousel('mods-carousel', -1)">‚ùÆ</div>
        <div class="carousel-arrow right" onclick="scrollCarousel('mods-carousel', 1)">‚ùØ</div>

        <div id="mods-carousel" class="carousel-container">
            <p>Cargando mods...</p>
        </div>
    </div>

</div>

<!-- FOOTER -->
<footer class="text-center py-4 mt-5 bg-dark">
    ¬© 2025 - Mi Blog Anime Dark ¬∑ Todos los derechos reservados
</footer>

<!-- MODAL DE MODS -->
<div class="modal fade" id="modModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <div id="modal-blur" class="modal-bg-blur"></div>

      <div class="modal-header border-0">
        <h5 id="modal-title" class="modal-title"></h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div class="row g-4 align-items-start">
          <div class="col-12 col-md-5 text-center">
            <img id="modal-img">
          </div>
          <div class="col-12 col-md-7">
            <small id="modal-fecha" class="text-secondary d-block mb-1"></small>
            <small id="modal-categorias" class="text-secondary d-block mb-2"></small>
            <p id="modal-desc" class="mb-4"></p>
            <a id="modal-video" target="_blank" class="btn btn-primary w-100 mb-2">Ver Video</a>
            <a id="modal-download" target="_blank" class="btn btn-secondary w-100">Descargar Mod</a>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- LIGHTBOX -->
<div id="lightbox-bg">
  <img id="lightbox-img">
</div>

<script>
/* ========================================================= */
/* ==================== CONFIG & HELPERS =================== */
/* ========================================================= */

const API_KEY = "AIzaSyCrLWKQFw9pW-YRuPtjG10yj0rycxJLvHE";
const CHANNEL_ID = "UCG_Oh0Ty-spxPukCEvfXWjQ";
const CACHE_TIME = 60 * 60 * 1000;

function scrollCarousel(id, dir) {
    const el = document.getElementById(id);
    el.scrollBy({ left: dir * 400, behavior: "smooth" });
}

function limpiarURL(url) {
    if (!url) return "";
    return url
        .replace(/\s*\.\s*/g, ".")
        .replace(/\s+/g, "")
        .replace(/\[dot\]/gi, ".")
        .replace(/\(dot\)/gi, ".")
        .replace(/^http(s?):\/\//, "https://");
}

async function fetchYouTube() {
    const cache = localStorage.getItem("yt_cache");
    const cacheTime = localStorage.getItem("yt_cache_time");

    if (cache && cacheTime && (Date.now() - cacheTime) < CACHE_TIME)
        return JSON.parse(cache);

    const url = `https://www.googleapis.com/youtube/v3/search?key=${API_KEY}&channelId=${CHANNEL_ID}&part=snippet,id&order=date&maxResults=50`;

    const resp = await fetch(url);
    const data = await resp.json();

    localStorage.setItem("yt_cache", JSON.stringify(data));
    localStorage.setItem("yt_cache_time", Date.now());

    return data;
}

/* ========================================================= */
/* ==================== RENDER VIDEOS ====================== */
/* ========================================================= */

function renderVideos(items) {
    const cont = document.getElementById("videos-carousel");
    cont.innerHTML = "";

    const videos = items.filter(i => i.id.videoId);

    videos.slice(0, 12).forEach(item => {
        cont.innerHTML += `
        <div class="n-card">
            <img src="${item.snippet.thumbnails.medium.url}">
            <div class="body">
                <h6>${item.snippet.title.substring(0,40)}...</h6>
                <small class="text-secondary">${item.snippet.publishedAt.substring(0,10)}</small>
            </div>
        </div>`;
    });
}

/* ========================================================= */
/* ===================== RENDER POPULAR ==================== */
/* ========================================================= */
function renderPopular(items) {
    const vid = items[0];
    if (!vid) return;

    document.getElementById("popular-video").src =
      `https://www.youtube.com/embed/${vid.id.videoId}`;
    document.getElementById("popular-title").innerText = vid.snippet.title;
    document.getElementById("popular-date").innerText = vid.snippet.publishedAt.substring(0,10);
    document.getElementById("popular-desc").innerText = vid.snippet.description.substring(0,200);
}

/* ========================================================= */
/* ===================== PARSE MODS ======================== */
/* ========================================================= */

let mods = [];

function parseModFromVideo(item) {
    const title = item.snippet.title;
    if (!title.startsWith("[Mod]")) return null;

    const videoID = item.id.videoId;
    const desc = item.snippet.description;

    let categorias = [];
    let linkMod = "";
    let textoDesc = desc;

    const lines = desc.split("\n");

    lines.forEach(l => {
        const ln = l.trim();

        if (ln.startsWith("Categorias:")) {
            let raw = ln.replace("Categorias:", "").trim();

            raw = raw.split(".")[0];
            raw = raw.split("http")[0];
            raw = raw.split("Resubire")[0];
            raw = raw.split("|")[0];
            raw = raw.split("- ")[0];

            categorias = raw.split(",")
                             .map(x => x.trim())
                             .filter(x => x.length > 0);
        }

        if (ln.startsWith("Mod:")) {
            linkMod = limpiarURL(ln.replace("Mod:", "").trim());
        }
    });

    return {
        name: title.replace("[Mod]", "").trim(),
        fecha: item.snippet.publishedAt.substring(0,10),
        categorias,
        desc: textoDesc,
        video: `https://www.youtube.com/watch?v=${videoID}`,
        mod: linkMod,
        thumbnail: item.snippet.thumbnails.high.url,
        imagen_mod: `https://i.ytimg.com/vi/${videoID}/maxresdefault.jpg`,
        videoID
    };
}

/* ========================================================= */
/* ===================== RENDER MODS ======================= */
/* ========================================================= */

function renderMods() {
    const cont = document.getElementById("mods-carousel");
    cont.innerHTML = "";

    mods.forEach(m => {
        cont.innerHTML += `
        <div class="n-card" onclick="abrirModal('${m.videoID}')">
            <img src="${m.thumbnail}">
            <div class="body">
                <h6>${m.name.substring(0,40)}...</h6>
                <small class="text-secondary">${m.fecha}</small>
            </div>
        </div>`;
    });
}

/* ========================================================= */
/* ======================== MODAL ========================== */
/* ========================================================= */

function abrirModal(videoID) {
    const m = mods.find(x => x.videoID === videoID);

    document.getElementById("modal-img").src = m.imagen_mod;
    document.getElementById("modal-title").innerText = m.name;
    document.getElementById("modal-fecha").innerText = "Publicado: " + m.fecha;
    document.getElementById("modal-categorias").innerText = "Categor√≠as: " + m.categorias.join(", ");
    document.getElementById("modal-desc").innerText = m.desc;
    document.getElementById("modal-video").href = m.video;
    document.getElementById("modal-download").href = m.mod;

    document.getElementById("modal-blur").style.backgroundImage = `url('${m.thumbnail}')`;

    document.getElementById("modal-img").onclick = () => {
        document.getElementById("lightbox-img").src = m.imagen_mod;
        document.getElementById("lightbox-bg").style.display = "flex";
    };

    new bootstrap.Modal(document.getElementById("modModal")).show();
}

document.getElementById("lightbox-bg").onclick = () => {
    document.getElementById("lightbox-bg").style.display = "none";
};

/* ========================================================= */
/* ========================= START ========================= */
/* ========================================================= */

(async () => {
    const data = await fetchYouTube();
    const items = data.items || [];

    renderVideos(items);
    renderPopular(items);

    mods = items.map(parseModFromVideo).filter(x => x !== null);
    renderMods();

    /* EXPORT MODS TO CONSOLE */
    console.log("üì¶ MODS DETECTADOS (copia y pega en mods.json):");
    console.log(JSON.stringify(mods, null, 2));
})();

</script>

</body>
</html>
