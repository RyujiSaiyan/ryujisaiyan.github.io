<!DOCTYPE html>
<html lang="es" data-bs-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Mods Automáticos – RyujiSaiyan</title>

<!-- BOOTSTRAP -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<style>
/* ==========================================
   PALETA ANIME LAVANDA + DARK
   ========================================== */
:root {
    --bg: #0A1228;
    --text: #E8ECF9;
    --primary: #A39ACB;
    --primary-glow: rgba(163,154,203,0.65);
    --card-bg: #1B1E24;
    --border: #2F333D;
}

body {
    background: var(--bg);
    color: var(--text);
    font-family: "Roboto", sans-serif;
}

/* TITULOS */
.section-title {
    border-left: 5px solid var(--primary);
    padding-left: 12px;
    margin-top: 50px;
    margin-bottom: 20px;
    font-size: 1.6rem;
}

/* CARDS */
.card {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    transition: 0.18s ease;
}
.card:hover {
    transform: translateY(-6px);
    box-shadow: 0 0 16px var(--primary-glow);
}
.card img {
    height: 180px;
    object-fit: cover;
}

/* MAIN VIDEO */
.main-video iframe {
    width: 100%;
    height: 430px;
    border-radius: 16px;
}

/* MODAL */
.modal-bg-blur {
    position: absolute;
    inset: 0;
    z-index: 1;
    filter: blur(20px);
    opacity: 0.32;
    background-size: cover !important;
    background-position: center !important;
    border-radius: 16px;
}

.modal-content {
    position: relative;
    z-index: 3;
    background: rgba(10, 15, 30, 0.85) !important;
    backdrop-filter: blur(6px);
    border: 1px solid var(--primary);
    border-radius: 18px;
}

#modal-img {
    width: 100%;
    border-radius: 14px;
    border: 2px solid var(--primary);
    box-shadow: 0 0 25px rgba(0,0,0,0.6);
}

/* NEON ANIMACIÓN */
.neon-appear {
    animation: neonPop 0.55s ease forwards;
}
@keyframes neonPop {
    0% { opacity: 0; transform: scale(0.8); }
    60% { opacity: 1; transform: scale(1.04); box-shadow: 0 0 24px var(--primary-glow);}
    100% { transform: scale(1); box-shadow: 0 0 16px var(--primary-glow);}
}

/* LIGHTBOX */
#lightbox-bg {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    z-index: 999999;
    justify-content: center;
    align-items: center;
}
#lightbox-img {
    max-width: 90%;
    max-height: 90%;
    border-radius: 14px;
    border: 2px solid var(--primary);
    animation: neonPop 0.5s ease forwards;
}

</style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
  <a class="navbar-brand fw-bold" href="#">RyujiSaiyan</a>

  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navMenu">
    <ul class="navbar-nav ms-auto">
      <li class="nav-item"><a class="nav-link" href="#videos">Videos</a></li>
      <li class="nav-item"><a class="nav-link" href="#mods">Mods Automáticos</a></li>
    </ul>
  </div>
</nav>

<div class="container py-4">

    <!-- SECCIÓN: MÁS POPULAR -->
    <h2 class="section-title">Más popular</h2>

    <div class="main-video mb-4">
        <iframe id="popular-video" allowfullscreen></iframe>
        <h3 id="popular-title" class="mt-3">Cargando…</h3>
        <small id="popular-date" class="text-secondary"></small>
        <p id="popular-desc" class="text-secondary mt-2"></p>
    </div>

    <!-- ÚLTIMOS VIDEOS -->
    <h2 class="section-title" id="videos">Últimos videos</h2>
    <div id="youtube-feed" class="row g-4">
        <p>Cargando…</p>
    </div>

    <!-- MODS -->
    <h2 class="section-title" id="mods">Mods Automáticos</h2>

    <!-- Dropdown filtros -->
    <div class="dropdown mb-3">
      <button class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown">
        Filtrar categorías
      </button>
      <div class="dropdown-menu" id="mods-dropdown"></div>
    </div>

    <!-- GRID MODS -->
    <div class="row g-4" id="mods-section">
        <p>Cargando mods…</p>
    </div>

</div>

<footer class="text-center py-4 bg-dark mt-5">
    © 2025 - RyujiSaiyan · Sistema Automático de Mods
</footer>

<!-- LIGHTBOX -->
<div id="lightbox-bg"><img id="lightbox-img"></div>

<!-- ========== YOUTUBE API ========== -->
<script>
const API_KEY = "AIzaSyCrLWKQFw9pW-YRuPtjG10yj0rycxJLvHE";
const CHANNEL_ID = "UCG_Oh0Ty-spxPukCEvfXWjQ";

/* ==========================
   CARGAR ÚLTIMOS VIDEOS
   ========================== */
async function cargarUltimosVideos() {
    const url =
    `https://www.googleapis.com/youtube/v3/search?key=${API_KEY}&channelId=${CHANNEL_ID}&part=snippet,id&order=date&maxResults=6`;

    const resp = await fetch(url);
    const data = await resp.json();

    const cont = document.getElementById("youtube-feed");
    cont.innerHTML = "";

    data.items.forEach(item => {
        if (!item.id.videoId) return;

        cont.innerHTML += `
        <div class="col-12 col-md-6 col-lg-4">
            <div class="card h-100">
                <img src="${item.snippet.thumbnails.high.url}">
                <div class="card-body">
                    <h5 class="card-title">${item.snippet.title}</h5>

                    <small class="text-secondary d-block">
                        ${item.snippet.publishedAt.substring(0,10)}
                    </small>

                    <p class="card-text text-secondary">
                        ${item.snippet.description.substring(0,120)}…
                    </p>

                    <a class="btn btn-primary w-100"
                        href="https://www.youtube.com/watch?v=${item.id.videoId}"
                        target="_blank">Ver video</a>
                </div>
            </div>
        </div>`;
    });
}

/* ==========================
   VIDEO POPULAR
   ========================== */
async function cargarPopular() {
    const url =
    `https://www.googleapis.com/youtube/v3/search?key=${API_KEY}&channelId=${CHANNEL_ID}&part=snippet,id&order=viewCount&maxResults=1`;

    const r = await fetch(url);
    const d = await r.json();

    const i = d.items[0];

    document.getElementById("popular-video").src =
        `https://www.youtube.com/embed/${i.id.videoId}`;

    document.getElementById("popular-title").innerText = i.snippet.title;
    document.getElementById("popular-date").innerText = i.snippet.publishedAt.substring(0,10);
    document.getElementById("popular-desc").innerText = i.snippet.description.substring(0,200);
}

cargarUltimosVideos();
cargarPopular();
</script>

<!-- ============================================
     SISTEMA DE MODS AUTOMÁTICOS DESDE YOUTUBE
     ============================================ -->
<script>

let modsAuto = [];
let categoriasSet = new Set();
let filtrosSet = new Set();

/* ============================================
   UTIL — EXTRAER CATEGORÍAS
   Formato esperado:
   Categorias: algo, algo, algo
   ============================================ */
function extraerCategorias(desc) {
    let lines = desc.replace(/\r/g, "").split("\n").map(l => l.trim());

    let linea = lines.find(l => l.toLowerCase().startsWith("categorias:"));
    if (!linea) return [];

    linea = linea.replace(/categorias:/i, "").trim();

    let cats = linea.split(",").map(c => c.trim());

    // Filtrar basura accidental
    return cats.filter(c =>
        c.length > 0 &&
        !c.toLowerCase().includes("http") &&
        !c.match(/mod:/i) &&
        !c.match(/resub/i)
    );
}

/* ============================================
   UTIL — EXTRAER LINK DEL MOD (formato con espacio)
   Mod: https://mega . nz/file/XXXX
   ============================================ */
function extraerLinkMod(desc) {
    let lines = desc.replace(/\r/g, "").split("\n").map(l => l.trim());
    let linea = lines.find(l => l.toLowerCase().startsWith("mod:"));
    if (!linea) return "";

    linea = linea.replace(/mod:/i, "").trim();

    // Quitar espacios protegidos
    linea = linea.replace(" . ", ".");
    linea = linea.replace(" .", ".");
    linea = linea.replace(". ", ".");

    return linea.trim();
}

/* ============================================
   CARGAR MODS AUTOMÁTICOS DESDE YOUTUBE
   ============================================ */
async function cargarModsAutomaticos() {
    const url =
    `https://www.googleapis.com/youtube/v3/search?key=${API_KEY}&channelId=${CHANNEL_ID}&part=snippet,id&order=date&maxResults=40`;

    const resp = await fetch(url);
    const data = await resp.json();

    modsAuto = [];

    data.items.forEach(item => {
        if (!item.id.videoId) return;
        if (!item.snippet.title.toLowerCase().includes("[mod]")) return;

        let desc = item.snippet.description || "";
        let cats = extraerCategorias(desc);
        let modLink = extraerLinkMod(desc);

        // Miniaturas
        let vid = item.id.videoId;
        let maxRes = `https://i.ytimg.com/vi/${vid}/maxresdefault.jpg`;
        let hq =     `https://i.ytimg.com/vi/${vid}/hqdefault.jpg`;

        modsAuto.push({
            name: item.snippet.title.replace("[Mod]", "").trim(),
            fecha: item.snippet.publishedAt.substring(0,10),
            categorias: cats,
            video: `https://www.youtube.com/watch?v=${vid}`,
            mod: modLink,
            desc: desc,
            thumbnail: maxRes,
            imagen_mod: maxRes
        });

        cats.forEach(c => categoriasSet.add(c));
    });

    generarDropdownMods();
    renderMods();
}

/* ============================================
   GENERAR FILTROS DINÁMICOS
   ============================================ */
function generarDropdownMods() {
    const dd = document.getElementById("mods-dropdown");
    dd.innerHTML = `
        <label class="dropdown-item">
            <input type="checkbox" value="ALL" onchange="toggleFiltro(this)"> Mostrar todos
        </label>
        <hr class="dropdown-divider">
    `;

    categoriasSet.forEach(cat => {
        dd.innerHTML += `
        <label class="dropdown-item">
            <input type="checkbox" value="${cat}" onchange="toggleFiltro(this)"> ${cat}
        </label>
        `;
    });
}

/* ============================================
   APLICAR FILTROS
   ============================================ */
function toggleFiltro(chk) {

    if (chk.value === "ALL") {
        filtrosSet.clear();
        renderMods();
        document.querySelectorAll('#mods-dropdown input').forEach(i => i.checked = false);
        return;
    }

    if (chk.checked) filtrosSet.add(chk.value);
    else filtrosSet.delete(chk.value);

    renderMods();
}

/* ============================================
   RENDERIZAR GRID
   ============================================ */
function renderMods() {
    const cont = document.getElementById("mods-section");
    cont.innerHTML = "";

    let lista = modsAuto;

    if (filtrosSet.size > 0) {
        lista = lista.filter(m => [...filtrosSet].every(f => m.categorias.includes(f)));
    }

    if (lista.length === 0) {
        cont.innerHTML = "<p>No hay mods con esas categorías.</p>";
        return;
    }

    lista.forEach(m => {
        cont.innerHTML += `
        <div class="col-12 col-md-6 col-lg-4">
            <div class="card h-100" onclick="abrirModal('${m.video}')">
                <img src="${m.thumbnail}">
                <div class="card-body">
                    <h5 class="card-title">${m.name}</h5>
                    <small class="text-secondary d-block">Fecha: ${m.fecha}</small>
                    <small class="text-secondary d-block mb-2">Categorias: ${m.categorias.join(", ")}</small>
                    <p class="text-secondary">${m.desc.substring(0,130)}…</p>
                </div>
            </div>
        </div>
        `;
    });
}

/* ============================================
   MODAL — MOSTRAR
   ============================================ */
function abrirModal(videoURL) {
    const m = modsAuto.find(x => x.video === videoURL);

    let vidID = "";
    if (videoURL.includes("v=")) {
        vidID = videoURL.split("v=")[1].split("&")[0];
    } else {
        vidID = videoURL.split("/").pop();
    }

    // Imagen HD
    const maxRes = `https://i.ytimg.com/vi/${vidID}/maxresdefault.jpg`;
    const hq =     `https://i.ytimg.com/vi/${vidID}/hqdefault.jpg`;

    const img = document.getElementById("modal-img");
    img.src = maxRes;
    img.classList.add("neon-appear");
    img.onerror = () => img.src = hq;

    // Fondo blur
    document.getElementById("modal-blur").style.backgroundImage = `url("${m.thumbnail}")`;

    document.getElementById("modal-title").innerText = m.name;
    document.getElementById("modal-fecha").innerText = "Publicado: " + m.fecha;
    document.getElementById("modal-categorias").innerText = "Categorías: " + m.categorias.join(", ");
    document.getElementById("modal-desc").innerText = m.desc;

    document.getElementById("modal-video").href = m.video;
    document.getElementById("modal-download").href = m.mod;

    img.onclick = () => {
        document.getElementById("lightbox-img").src = img.src;
        document.getElementById("lightbox-bg").style.display = "flex";
    };

    const modal = new bootstrap.Modal(document.getElementById("modModal"));
    modal.show();
}

document.getElementById("lightbox-bg").onclick = () => {
    document.getElementById("lightbox-bg").style.display = "none";
};

/* ============================================
   EXPORTAR JSON PARA GITHUB ACTIONS
   ============================================ */
async function exportarJSON() {
    if (modsAuto.length === 0) {
        alert("No hay mods cargados para exportar.");
        return;
    }

    const modsStr = JSON.stringify(modsAuto);

    await fetch(
        "https://api.github.com/repos/RyujiSaiyan/ryujisaiyan.github.io/actions/workflows/update_mods.yml/dispatches",
        {
            method: "POST",
            headers: {
                "Accept": "application/vnd.github+json",
                "Authorization": "Bearer MODS_TOKEN_REPLACED"
            },
            body: JSON.stringify({
                ref: "main",
                inputs: { mods_json: modsStr }
            })
        }
    );

    alert("Mods enviados a GitHub Actions ✔");
}

/* ============================================
   BOTÓN OCULTO (Ctrl + M)
   ============================================ */
document.addEventListener("keydown", (e) => {
    if (e.ctrlKey && e.key.toLowerCase() === "m") {
        if (confirm("¿Enviar mods a GitHub y actualizar mods.json?")) {
            exportarJSON();
        }
    }
});

/* ============================================
   INICIO
   ============================================ */
cargarModsAutomaticos();

</script>

<!-- MODAL DE MODS -->
<div class="modal fade" id="modModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">

    <div class="modal-content">

      <div id="modal-blur" class="modal-bg-blur"></div>

      <div class="modal-header border-0">
        <h5 id="modal-title" class="modal-title"></h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">

        <div class="row g-4">

          <div class="col-12 col-md-5">
            <img id="modal-img">
          </div>

          <div class="col-12 col-md-7">
            <small id="modal-fecha" class="text-secondary d-block mb-1"></small>
            <small id="modal-categorias" class="text-secondary d-block mb-2"></small>
            <p id="modal-desc" class="mb-4"></p>

            <a id="modal-video" target="_blank" class="btn btn-primary w-100 mb-2">
              Ver Video
            </a>

            <a id="modal-download" target="_blank" class="btn btn-outline-primary w-100">
              Descargar Mod
            </a>
          </div>

        </div>

      </div>
    </div>
  </div>
</div>

<!-- FIN PARTE 2 -->
