<!DOCTYPE html>
<html lang="es" data-bs-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Mi Blog Dark Anime</title>

<!-- BOOTSTRAP -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<style>
/* -------------------- */
/* PALETA ANIME LAVANDA */
/* -------------------- */
:root {
    --bs-body-bg: #0A1228;
    --bs-body-color: #E8ECF9;

    --bs-primary: #A39ACB;
    --bs-primary-rgb: 163,154,203;

    --bs-secondary: #9DA2C8;
    --bs-secondary-rgb: 157,162,200;

    --bs-dark: #1B1E24;
    --bs-dark-rgb: 27,30,36;

    --bs-border-color: #2F333D;

    --bs-card-bg: #1B1E24;
    --bs-card-border-color: #2F333D;
}

/* Global */
body {
    background: #0A1228;
    color: var(--bs-body-color);
    font-family: "Roboto", sans-serif;
}

/* Section titles */
.section-title {
    border-left: 5px solid var(--bs-primary);
    padding-left: 12px;
    margin-top: 50px;
    margin-bottom: 20px;
    font-size: 1.6rem;
}

/* Cards */
.card {
    background: var(--bs-card-bg);
    border: 1px solid var(--bs-border-color);
    border-radius: 12px;
    overflow: hidden;
    transition: 0.2s ease;
}
.card:hover {
    transform: translateY(-6px);
    border-color: var(--bs-primary);
    box-shadow: 0px 0px 12px rgba(163,154,203,0.4);
}
.card img {
    object-fit: cover;
    height: 180px;
}

/* Main video */
.main-video iframe {
    width: 100%;
    height: 420px;
    border-radius: 12px;
}

/* ===== MODAL ANIME PREMIUM ===== */

.modal-bg-blur {
    position: absolute;
    inset: 0;
    z-index: 1;
    background-size: cover !important;
    background-position: center !important;
    filter: blur(18px);
    opacity: 0.35;
    border-radius: 18px;
    pointer-events: none !important;
}

.modal-content {
    position: relative;
    z-index: 2;
    background: rgba(16, 22, 38, 0.85) !important;
    backdrop-filter: blur(6px);
    border-radius: 18px !important;
    border: 1px solid #A39ACB !important;
}

#modal-img {
    width: 100%;
    max-width: 360px;
    border-radius: 16px;
    border: 2px solid rgba(163,154,203,0.5);
    box-shadow: 0px 0px 25px rgba(0,0,0,0.6);
}

/* Animación NEÓN */
.neon-appear {
    animation: neonPop 0.5s ease forwards;
}

@keyframes neonPop {
    0% {
        opacity: 0;
        transform: scale(0.85);
        box-shadow: 0 0 0 rgba(163,154,203,0);
    }
    60% {
        opacity: 1;
        transform: scale(1.02);
        box-shadow: 0 0 25px rgba(163,154,203,0.8);
    }
    100% {
        transform: scale(1);
        box-shadow: 0 0 15px rgba(163,154,203,0.5);
    }
}

/* Hover neón */
#modal-img:hover {
    box-shadow: 0 0 28px rgba(163,154,203,0.9);
    transition: 0.3s ease;
    transform: scale(1.03);
}

.modal-title {
    color: #E8ECF9;
    font-size: 1.6rem;
    font-weight: bold;
}

.btn-anime-primary {
    background: #A39ACB;
    color: #101626;
    font-weight: bold;
    border-radius: 10px;
}
.btn-anime-primary:hover {
    background: #c7bafd;
    box-shadow: 0px 0px 14px rgba(163,154,203,0.8);
}

.btn-anime-secondary {
    background: transparent;
    border: 2px solid #A39ACB;
    color: #E8ECF9;
    font-weight: bold;
    border-radius: 10px;
}
.btn-anime-secondary:hover {
    background: rgba(163,154,203,0.2);
}

/* ========= LIGHTBOX ========= */
#lightbox-bg {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(5px);
    z-index: 99999;
    justify-content: center;
    align-items: center;
}

#lightbox-img {
    max-width: 90%;
    max-height: 90%;
    border-radius: 18px;
    border: 2px solid #A39ACB;
    box-shadow: 0 0 25px rgba(163,154,203,0.8);
    animation: neonPop 0.4s ease forwards;
}

#lightbox-bg:hover {
    cursor: zoom-out;
}
</style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
  <a class="navbar-brand fw-bold" href="#">MiBlog</a>

  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navMenu">
    <ul class="navbar-nav ms-auto">
      <li class="nav-item"><a class="nav-link" href="#">Inicio</a></li>
      <li class="nav-item"><a class="nav-link" href="#videos">Videos</a></li>
      <li class="nav-item"><a class="nav-link" href="#mods">Mods</a></li>
    </ul>
  </div>
</nav>

<!-- CONTENIDO -->
<div class="container-fluid py-4">

    <!-- SECCIÓN: MÁS POPULAR -->
    <h2 class="section-title">Más popular</h2>
    <div class="main-video mb-4">
        <iframe id="popular-video" src="" allowfullscreen></iframe>
        <h3 id="popular-title" class="mt-3">Cargando...</h3>
        <small id="popular-date" class="text-secondary"></small>
        <p id="popular-desc" class="text-secondary mt-2">Obteniendo el video más visto...</p>
    </div>

    <!-- ÚLTIMOS VIDEOS -->
    <h2 class="section-title" id="videos">Últimos videos</h2>
    <div id="youtube-feed" class="row g-4">
        <p>Cargando videos...</p>
    </div>

    <!-- MODS -->
    <h2 class="section-title" id="mods">Mods</h2>

    <!-- Dropdown filtros -->
    <div class="dropdown mb-3">
      <button class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown">
        Filtrar por categoría
      </button>
      <div class="dropdown-menu" id="mods-dropdown"></div>
    </div>

    <!-- GRID DE MODS -->
    <div class="row g-4" id="mods-section">
        <p>Cargando mods...</p>
    </div>
</div>

<!-- FOOTER -->
<footer class="text-center py-4 mt-5 bg-dark">
    © 2025 - Mi Blog Anime Dark · Todos los derechos reservados
</footer>

<!-- MODAL DE MODS -->
<div class="modal fade" id="modModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">

    <div class="modal-content">

      <!-- FONDO BORROSO -->
      <div id="modal-blur" class="modal-bg-blur"></div>

      <div class="modal-header border-0">
        <h5 id="modal-title" class="modal-title"></h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div class="row g-4 align-items-start">

          <div class="col-12 col-md-5 text-center">
            <img id="modal-img">
          </div>

          <div class="col-12 col-md-7">
            <small id="modal-fecha" class="text-secondary d-block mb-1"></small>
            <small id="modal-categorias" class="text-secondary d-block mb-2"></small>

            <p id="modal-desc" class="mb-4"></p>

            <a id="modal-video" target="_blank" class="btn btn-anime-primary w-100 mb-2">
              Ver Video
            </a>

            <a id="modal-download" target="_blank" class="btn btn-anime-secondary w-100">
              Descargar Mods
            </a>
          </div>

        </div>
      </div>

    </div>

  </div>
</div>

<!-- LIGHTBOX -->
<div id="lightbox-bg">
  <img id="lightbox-img">
</div>

<!-- YOUTUBE API -->
<script>
const API_KEY = "AIzaSyDIiIJZYI_mXtF0884sZQmb1HWcuwMODRA";
const CHANNEL_ID = "UCG_Oh0Ty-spxPukCEvfXWjQ";

async function cargarUltimosVideos() {
    const url = 
    `https://www.googleapis.com/youtube/v3/search?key=${API_KEY}&channelId=${CHANNEL_ID}&part=snippet,id&order=date&pageToken=&maxResults=4`;

    const resp = await fetch(url);
    const data = await resp.json();

    const cont = document.getElementById("youtube-feed");
    cont.innerHTML = "";

    data.items.forEach(item => {
        if (item.id.videoId) {
            cont.innerHTML += `
            <div class="col-12 col-md-6 col-lg-3">
              <div class="card h-100">
                <img src="${item.snippet.thumbnails.high.url}" class="card-img-top">

                <div class="card-body">
                  <h5 class="card-title">${item.snippet.title}</h5>

                  <small class="text-secondary d-block mb-2">
                    ${item.snippet.publishedAt.substring(0,10)}
                  </small>

                  <p class="card-text text-secondary">${item.snippet.description.substring(0,100)}...</p>

                  <a class="btn btn-primary w-100" target="_blank"
                     href="https://www.youtube.com/watch?v=${item.id.videoId}">
                     Ver video
                  </a>
                </div>
              </div>
            </div>`;
        }
    });
}

async function cargarPopular() {
    const url = 
    `https://www.googleapis.com/youtube/v3/search?key=${API_KEY}&channelId=${CHANNEL_ID}&part=snippet,id&order=viewCount&maxResults=1`;

    const resp = await fetch(url);
    const data = await resp.json();

    const item = data.items[0];

    document.getElementById("popular-video").src =
        `https://www.youtube.com/embed/${item.id.videoId}`;

    document.getElementById("popular-title").innerText = item.snippet.title;

    document.getElementById("popular-date").innerText =
        item.snippet.publishedAt.substring(0,10);

    document.getElementById("popular-desc").innerText =
        item.snippet.description.substring(0,200);
}

cargarUltimosVideos();
cargarPopular();
</script>

<!-- SISTEMA AUTOMÁTICO DE MODS -->
<script>
let mods = [];
let categorias = new Set();
let filtros = new Set();

// Sanitizar URL del mod (quita espacios, "dot", etc.)
function limpiarURL(url) {
    if (!url) return "";
    return url
        .replace(/\s*\.\s*/g, ".")   
        .replace(/\s+/g, "")         
        .replace(/\[dot\]/gi, ".")
        .replace(/dot/gi, ".")
        .replace(/\(dot\)/gi, ".")
        .replace(/\[.\]/g, ".")
        .replace(/\.{2,}/g, ".")
        .replace(/^http(s?):\/\//, "https://");
}

// Cargar mods desde videos del canal
async function cargarMods() {

    const url =
    `https://www.googleapis.com/youtube/v3/search?key=${API_KEY}&channelId=${CHANNEL_ID}&part=snippet,id&order=date&maxResults=50`;

    const resp = await fetch(url);
    const data = await resp.json();

    data.items.forEach(item => {
        if (!item.id.videoId) return;

        const title = item.snippet.title;

        if (!title.startsWith("[Mod]")) return;

        const descripcion = item.snippet.description;

        let categoriasTxt = "";
        let modLink = "";

        descripcion.split("\n").forEach(line => {
            line = line.trim();

            if (line.startsWith("Categorias:")) {
                categoriasTxt = line.replace("Categorias:", "").trim();
            }

            if (line.startsWith("Mod:")) {
                modLink = line.replace("Mod:", "").trim();
            }
        });

        const categoriasArr =
            categoriasTxt.split(",")
            .map(c => c.trim())
            .filter(x => x.length > 0);

        categoriasArr.forEach(c => categorias.add(c));

        const videoID = item.id.videoId;

        const modObj = {
            name: title.replace("[Mod]", "").trim(),
            fecha: item.snippet.publishedAt.substring(0,10),
            categorias: categoriasArr,
            video: `https://www.youtube.com/watch?v=${videoID}`,
            desc: descripcion.split("Categorias:")[0].trim(),
            mod: limpiarURL(modLink),
            imagen_mod: `https://i.ytimg.com/vi/${videoID}/maxresdefault.jpg`,
            thumbnail: item.snippet.thumbnails.high.url
        };

        mods.push(modObj);
    });

    generarDropdown();
    renderMods();
}

function generarDropdown() {
    const dd = document.getElementById("mods-dropdown");
    dd.innerHTML = `
        <label class="dropdown-item">
            <input type="checkbox" value="ALL" onchange="toggleFiltro(this)"> Mostrar todos
        </label>
        <hr class="dropdown-divider">
    `;

    categorias.forEach(cat => {
        dd.innerHTML += `
        <label class="dropdown-item">
            <input type="checkbox" value="${cat}" onchange="toggleFiltro(this)"> ${cat}
        </label>`;
    });
}

function toggleFiltro(chk) {
    if (chk.value === "ALL") {
        filtros.clear();
        renderMods();
        document.querySelectorAll('#mods-dropdown input').forEach(i => i.checked = false);
        return;
    }

    if (chk.checked) filtros.add(chk.value);
    else filtros.delete(chk.value);

    renderMods();
}

function renderMods() {
    const cont = document.getElementById("mods-section");
    cont.innerHTML = "";

    let lista = mods;

    if (filtros.size > 0) {
        lista = mods.filter(m => 
            [...filtros].every(f => m.categorias.includes(f))
        );
    }

    if (lista.length === 0) {
        cont.innerHTML = "<p>No hay mods con esas categorías.</p>";
        return;
    }

    lista.forEach(m => {
        cont.innerHTML += `
        <div class="col-12 col-md-6 col-lg-4">
          <div class="card h-100" onclick="abrirModal('${m.name}')">
            <img src="${m.thumbnail}" class="card-img-top">
            <div class="card-body">

              <h5 class="card-title">${m.name}</h5>

              <small class="text-secondary d-block mb-2">
                ${m.fecha}
              </small>

              <p class="card-text text-secondary">
                ${m.desc.substring(0,100)}...
              </p>

            </div>
          </div>
        </div>`;
    });
}

function abrirModal(nombre) {
    const m = mods.find(x => x.name === nombre);

    let videoID = m.video.split("v=")[1];

    const maxRes = `https://i.ytimg.com/vi/${videoID}/maxresdefault.jpg`;
    const hq =     `https://i.ytimg.com/vi/${videoID}/hqdefault.jpg`;

    const img = document.getElementById("modal-img");
    img.src = maxRes;
    img.classList.add("neon-appear");

    img.onerror = () => { img.src = hq; };

    document.getElementById("modal-blur").style.backgroundImage =
        `url('${m.thumbnail}')`;

    document.getElementById("modal-title").innerText = m.name;
    document.getElementById("modal-fecha").innerText = "Publicado: " + m.fecha;
    document.getElementById("modal-categorias").innerText =
        "Categorías: " + m.categorias.join(", ");
    document.getElementById("modal-desc").innerText = m.desc;

    document.getElementById("modal-video").href = m.video;
    document.getElementById("modal-download").href = m.mod;

    img.onclick = () => {
        document.getElementById("lightbox-img").src = img.src;
        document.getElementById("lightbox-bg").style.display = "flex";
    };

    const modal = new bootstrap.Modal(document.getElementById("modModal"));
    modal.show();
}

document.addEventListener("click", function(e) {
    const bg = document.getElementById("lightbox-bg");
    if (bg.style.display === "flex" && e.target.id === "lightbox-bg") {
        bg.style.display = "none";
    }
});

document.addEventListener("keydown", function(e) {
    if (e.key === "Escape") {
        document.getElementById("lightbox-bg").style.display = "none";
    }
});

cargarMods();
</script>

</body>
</html>
